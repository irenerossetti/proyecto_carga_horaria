openapi: 3.0.3
info:
  title: Proyecto Carga Horaria - API
  version: 1.0.0
  description: Documentación OpenAPI mínima para los Casos de Uso CU01 y CU02 (Login / Logout)
servers:
  - url: http://localhost:8000
paths:
  /login:
    get:
      summary: Mostrar formulario de login (vista Fortify)
      tags:
        - Autenticación
      responses:
        '200':
          description: HTML del formulario de login
          content:
            text/html:
              schema:
                type: string
    post:
      summary: CU01 - Iniciar Sesión (enviar credenciales)
      tags:
        - Autenticación
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
                remember:
                  type: boolean
              required:
                - email
                - password
            example:
              email: usuario@dominio.com
              password: contrasena123
              remember: false
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
                remember:
                  type: string
            example:
              email: usuario@dominio.com
              password: contrasena123
              remember: on
      responses:
        '200':
          description: Login exitoso — en una app web suele redirigir; en API devuelve datos de sesión
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              example:
                message: "Authenticated"
        '302':
          description: Redirección (login web exitoso)
        '401':
          description: Credenciales inválidas
          content:
            application/json:
              example:
                message: "Invalid credentials"

  /logout:
    post:
      summary: CU02 - Cerrar Sesión (logout web)
      tags:
        - Autenticación
      description: |
        Fortify implementa logout vía POST a `/logout`. En la aplicación web esto usa la sesión (cookie).
      security:
        - cookieAuth: []
      responses:
        '204':
          description: Cierre de sesión exitoso (sin contenido)
        '302':
          description: Redirección tras logout (comportamiento web)
        '401':
          description: No autenticado
          content:
            application/json:
              example:
                message: "Unauthenticated"

  /forgot-password:
    get:
      summary: Mostrar formulario para solicitar restablecimiento de contraseña
      tags:
        - Autenticación
      responses:
        '200':
          description: HTML del formulario para solicitar el enlace de restablecimiento
          content:
            text/html:
              schema:
                type: string

    post:
      summary: CU03 - Solicitar restablecimiento de contraseña (enviar link por email)
      tags:
        - Autenticación
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
              required:
                - email
            example:
              email: admin@dominio.com
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                email:
                  type: string
            example:
              email: admin@dominio.com
      responses:
        '200':
          description: Solicitud aceptada — se enviará un enlace de restablecimiento si el email existe
          content:
            application/json:
              example:
                message: "If a user with that email exists, a password reset link has been sent."
        '302':
          description: Redirección (comportamiento web típico tras solicitar)

  /reset-password:
    get:
      summary: Mostrar formulario de restablecimiento (usa token en query string)
      tags:
        - Autenticación
      parameters:
        - in: query
          name: token
          schema:
            type: string
          required: true
          description: Token recibido por email para restablecer la contraseña
      responses:
        '200':
          description: HTML del formulario de restablecimiento de contraseña
          content:
            text/html:
              schema:
                type: string

    post:
      summary: Completar restablecimiento de contraseña (enviar nuevo password)
      tags:
        - Autenticación
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                email:
                  type: string
                password:
                  type: string
                password_confirmation:
                  type: string
              required:
                - token
                - email
                - password
                - password_confirmation
            example:
              token: "token-aqui"
              email: admin@dominio.com
              password: NewPass123!
              password_confirmation: NewPass123!
      responses:
        '200':
          description: Password restablecida correctamente (API)
          content:
            application/json:
              example:
                message: "Password reset successfully."
        '302':
          description: Redirección tras restablecer (comportamiento web)
        '400':
          description: Token inválido o datos inválidos
          content:
            application/json:
              example:
                message: "Invalid token or data"

  /api/periods:
    get:
      summary: CU04 - Listar periodos académicos (Admin)
      tags:
        - Periodos Académicos
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Lista de periodos
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    status:
                      type: string
                    start_date:
                      type: string
                      format: date
                    end_date:
                      type: string
                      format: date

    post:
      summary: CU04 - Crear periodo académico (Admin)
      tags:
        - Periodos Académicos
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                start_date:
                  type: string
                  format: date
                end_date:
                  type: string
                  format: date
              required:
                - name
            example:
              name: "Gestión 2-2025"
              start_date: "2025-07-01"
              end_date: "2025-12-31"
      responses:
        '201':
          description: Periodo creado
          content:
            application/json:
              example:
                id: 1
                name: "Gestión 2-2025"
                status: "draft"

  /api/periods/{id}/activate:
    post:
      summary: CU04 - Activar periodo académico (Admin)
      tags:
        - Periodos Académicos
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: ID del periodo a activar
      responses:
        '200':
          description: Periodo activado
          content:
            application/json:
              example:
                message: "Period activated"
                period:
                  id: 2
                  name: "Gestión 2-2025"
                  status: "active"
        '403':
          description: Forbidden (no admin)

  /api/periods/{id}/close:
    post:
      summary: CU04 - Cerrar periodo académico (Admin)
      tags:
        - Periodos Académicos
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: ID del periodo a cerrar
      responses:
        '200':
          description: Periodo cerrado
          content:
            application/json:
              example:
                message: "Period closed"
                period:
                  id: 2
                  name: "Gestión 2-2025"
                  status: "closed"
        '403':
          description: Forbidden (no admin)

  /api/periods/{id}:
    patch:
      summary: CU04 - Actualizar periodo académico (Admin)
      tags:
        - Periodos Académicos
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: ID del periodo a actualizar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                start_date:
                  type: string
                  format: date
                end_date:
                  type: string
                  format: date
                status:
                  type: string
                  enum: [draft, active, closed]
            example:
              name: "Gestión 2-2025 (editado)"
              start_date: "2025-07-01"
              end_date: "2025-12-31"
              status: "draft"
      responses:
        '200':
          description: Periodo actualizado
          content:
            application/json:
              example:
                message: "Period updated"
                period:
                  id: 2
                  name: "Gestión 2-2025 (editado)"
                  status: "draft"
        '422':
          description: Validación fallida

    delete:
      summary: CU04 - Eliminar periodo académico (Admin)
      tags:
        - Periodos Académicos
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: ID del periodo a eliminar
      responses:
        '200':
          description: Periodo eliminado
          content:
            application/json:
              example:
                message: "Period deleted"
                id: 2
        '403':
          description: Forbidden (no admin)

  /api/roles:
    get:
      summary: CU05 - Listar roles (Admin)
      tags:
        - Roles
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Lista de roles
          content:
            application/json:
              example:
                - administrador
                - docente
                - estudiante

    post:
      summary: CU05 - Crear rol (Admin)
      tags:
        - Roles
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
              required:
                - name
            example:
              name: administrador
      responses:
        '201':
          description: Rol creado
          content:
            application/json:
              example:
                id: 1
                name: administrador

  /api/roles/{id}:
    patch:
      summary: CU05 - Actualizar rol (Admin)
      tags:
        - Roles
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: ID del rol a actualizar
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
            example:
              name: administrador_ed
      responses:
        '200':
          description: Rol actualizado
          content:
            application/json:
              example:
                id: 1
                name: administrador_ed
        '422':
          description: Validación fallida

    delete:
      summary: CU05 - Eliminar rol (Admin)
      tags:
        - Roles
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: ID del rol a eliminar
      responses:
        '200':
          description: Rol eliminado
          content:
            application/json:
              example:
                message: "Role deleted"
                id: 1
        '409':
          description: Conflicto - el rol está asignado a usuarios y no puede eliminarse
          content:
            application/json:
              example:
                message: "Role is assigned to users, cannot delete"

  /api/users/{id}/roles:
    get:
      summary: CU05 - Obtener roles de un usuario (Admin)
      tags:
        - Roles
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Roles del usuario
          content:
            application/json:
              example:
                - docente

    post:
      summary: CU05 - Asignar roles a un usuario (Admin)
      tags:
        - Roles
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: string
              required:
                - roles
            example:
              roles: ["docente"]
      responses:
        '200':
          description: Roles asignados
          content:
            application/json:
              example:
                message: "Roles assigned"
                roles: ["docente"]

  /api/teachers:
    get:
      summary: CU06 - Listar docentes (Admin)
      tags:
        - Docentes
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Lista de docentes
          content:
            application/json:
              example:
                - id: 1
                  name: "Juan Perez"
                  email: "juan@uni.edu"

    post:
      summary: CU06 - Crear docente (Admin)
      tags:
        - Docentes
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                dni:
                  type: string
                phone:
                  type: string
                department:
                  type: string
              required:
                - name
                - email
            example:
              name: "Juan Perez"
              email: "juan@uni.edu"
              dni: "12345678"
      responses:
        '201':
          description: Docente creado
          content:
            application/json:
              example:
                id: 1
                name: "Juan Perez"
                email: "juan@uni.edu"

  /api/teachers/{id}:
    get:
      summary: CU06 - Obtener docente por id (Admin)
      tags:
        - Docentes
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Docente
          content:
            application/json:
              example:
                id: 1
                name: "Juan Perez"
                email: "juan@uni.edu"

    patch:
      summary: CU06 - Actualizar docente (Admin)
      tags:
        - Docentes
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                dni:
                  type: string
                phone:
                  type: string
                department:
                  type: string
            example:
              name: "Juan Perez (Editado)"
      responses:
        '200':
          description: Docente actualizado
          content:
            application/json:
              example:
                id: 1
                name: "Juan Perez (Editado)"

    delete:
      summary: CU06 - Eliminar docente (Admin)
      tags:
        - Docentes
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Docente eliminado
          content:
            application/json:
              example:
                message: "Teacher deleted"
                id: 1

  /api/teachers/me:
    get:
      summary: CU07 - Ver perfil del docente autenticado
      tags:
        - Docentes
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Perfil del docente
          content:
            application/json:
              example:
                id: 1
                name: "Juan Perez"
                email: "juan@uni.edu"
        '401':
          description: No autenticado
    patch:
      summary: CU07 - Editar perfil del docente autenticado
      tags:
        - Docentes
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                dni:
                  type: string
                phone:
                  type: string
                department:
                  type: string
            example:
              name: "Juan Perez (Editado)"
      responses:
        '200':
          description: Perfil actualizado
          content:
            application/json:
              example:
                id: 1
                name: "Juan Perez (Editado)"
        '422':
          description: Validación fallida

  /api/subjects:
    get:
      summary: CU08 - Listar materias (Admin)
      tags:
        - Materias
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Lista de materias
          content:
            application/json:
              example:
                - id: 1
                  code: "MAT101"
                  name: "Matemáticas I"

    post:
      summary: CU08 - Crear materia (Admin)
      tags:
        - Materias
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                name:
                  type: string
                credits:
                  type: integer
                description:
                  type: string
              required:
                - code
                - name
            example:
              code: "MAT101"
              name: "Matemáticas I"
              credits: 4
      responses:
        '201':
          description: Materia creada
          content:
            application/json:
              example:
                id: 1
                code: "MAT101"
                name: "Matemáticas I"

  /api/subjects/{id}:
    get:
      summary: CU08 - Obtener materia por id (Admin)
      tags:
        - Materias
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Materia
          content:
            application/json:
              example:
                id: 1
                code: "MAT101"
                name: "Matemáticas I"

    patch:
      summary: CU08 - Actualizar materia (Admin)
      tags:
        - Materias
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                name:
                  type: string
                credits:
                  type: integer
                description:
                  type: string
            example:
              name: "Matemáticas I (Editado)"
      responses:
        '200':
          description: Materia actualizada
          content:
            application/json:
              example:
                id: 1
                code: "MAT101"
                name: "Matemáticas I (Editado)"

    delete:
      summary: CU08 - Eliminar materia (Admin)
      tags:
        - Materias
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Materia eliminada
          content:
            application/json:
              example:
                message: "Subject deleted"
                id: 1

  /api/groups:
    get:
      summary: CU09 - Listar grupos (Admin)
      tags:
        - Grupos
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Lista de grupos
          content:
            application/json:
              example:
                - id: 1
                  subject_id: 1
                  code: "G1"
                  name: "Grupo 1"

    post:
      summary: CU09 - Crear grupo (Admin)
      tags:
        - Grupos
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                subject_id:
                  type: integer
                code:
                  type: string
                name:
                  type: string
                capacity:
                  type: integer
                schedule:
                  type: string
              required:
                - subject_id
                - code
                - name
            example:
              subject_id: 1
              code: "G1"
              name: "Grupo 1"
              capacity: 30
      responses:
        '201':
          description: Grupo creado
          content:
            application/json:
              example:
                id: 1
                subject_id: 1
                code: "G1"
                name: "Grupo 1"

  /api/groups/{id}:
    get:
      summary: CU09 - Obtener grupo por id (Admin)
      tags:
        - Grupos
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Grupo
          content:
            application/json:
              example:
                id: 1
                subject_id: 1
                code: "G1"
                name: "Grupo 1"

    patch:
      summary: CU09 - Actualizar grupo (Admin)
      tags:
        - Grupos
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                subject_id:
                  type: integer
                code:
                  type: string
                name:
                  type: string
                capacity:
                  type: integer
                schedule:
                  type: string
            example:
              name: "Grupo 1 (Editado)"
      responses:
        '200':
          description: Grupo actualizado
          content:
            application/json:
              example:
                id: 1
                name: "Grupo 1 (Editado)"

    delete:
      summary: CU09 - Eliminar grupo (Admin)
      tags:
        - Grupos
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Grupo eliminado
          content:
            application/json:
              example:
                message: "Group deleted"
                id: 1

  /api/rooms:
    get:
      summary: CU10 - Listar aulas (Admin)
      tags:
        - Aulas
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Lista de aulas
          content:
            application/json:
              example:
                - id: 1
                  name: "Aula 101"
                  capacity: 40

    post:
      summary: CU10 - Crear aula (Admin)
      tags:
        - Aulas
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                capacity:
                  type: integer
                location:
                  type: string
                resources:
                  type: string
              required:
                - name
            example:
              name: "Aula 101"
              capacity: 40
      responses:
        '201':
          description: Aula creada
          content:
            application/json:
              example:
                id: 1
                name: "Aula 101"
                capacity: 40

  /api/rooms/{id}:
    get:
      summary: CU10 - Obtener aula por id (Admin)
      tags:
        - Aulas
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Aula
          content:
            application/json:
              example:
                id: 1
                name: "Aula 101"
                capacity: 40

    patch:
      summary: CU10 - Actualizar aula (Admin)
      tags:
        - Aulas
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                capacity:
                  type: integer
                location:
                  type: string
                resources:
                  type: string
            example:
              name: "Aula 101 (Editado)"
      responses:
        '200':
          description: Aula actualizada
          content:
            application/json:
              example:
                id: 1
                name: "Aula 101 (Editado)"

    delete:
      summary: CU10 - Eliminar aula (Admin)
      tags:
        - Aulas
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Aula eliminada
          content:
            application/json:
              example:
                message: "Room deleted"
                id: 1

  /api/rooms/{id}/equipment:
    get:
      summary: CU11 - Obtener equipamiento de un aula (Admin)
      tags:
        - Aulas
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        '200':
          description: Equipamiento del aula
          content:
            application/json:
              example:
                id: 1
                equipment:
                  projector: true
                  capacity: 40
                  air_conditioning: true

    put:
      summary: CU11 - Definir/Actualizar equipamiento del aula (Admin)
      tags:
        - Aulas
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                equipment:
                  type: object
            example:
              equipment:
                projector: true
                capacity: 40
                air_conditioning: true
      responses:
        '200':
          description: Equipamiento actualizado
          content:
            application/json:
              example:
                id: 1
                equipment:
                  projector: true
                  capacity: 40
                  air_conditioning: true

  /api/imports:
    post:
      summary: "CU12 - Cargar datos masivos (CSV): docentes, materias o grupos (Admin)"
      tags:
        - Import
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [teachers, subjects, groups]
                file:
                  type: string
                  format: binary
              required:
                - type
                - file
            encoding:
              file:
                contentType: text/csv
      responses:
        '200':
          description: Resultado de la importación
          content:
            application/json:
              example:
                created: 10
                updated: 2
                errors: []

    /api/teachers/{id}/assignments:
      get:
        summary: CU13 - Listar asignaciones de carga horaria de un docente (Admin)
        tags:
          - Carga Horaria
        security:
          - cookieAuth: []
        parameters:
          - in: path
            name: id
            schema:
              type: integer
            required: true
            description: ID del docente
        responses:
          '200':
            description: Lista de asignaciones del docente
            content:
              application/json:
                example:
                  - id: 1
                    teacher_id: 1
                    subject_id: 2
                    group_id: 3
                    period_id: 1

    /api/assignments:
      get:
        summary: CU13 - Listar todas las asignaciones (Admin)
        tags:
          - Carga Horaria
        security:
          - cookieAuth: []
        parameters:
          - in: query
            name: teacher_id
            schema:
              type: integer
          - in: query
            name: period_id
            schema:
              type: integer
        responses:
          '200':
            description: Lista de asignaciones
            content:
              application/json:
                example:
                  - id: 1
                    teacher_id: 1
                    subject_id: 2
                    group_id: 3
                    period_id: 1

      post:
        summary: CU13 - Crear asignación de carga horaria (Admin)
        tags:
          - Carga Horaria
        security:
          - cookieAuth: []
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  teacher_id:
                    type: integer
                  subject_id:
                    type: integer
                  group_id:
                    type: integer
                  period_id:
                    type: integer
                required:
                  - teacher_id
              example:
                teacher_id: 1
                subject_id: 2
                group_id: 3
                period_id: 1
        responses:
          '201':
            description: Asignación creada
            content:
              application/json:
                example:
                  id: 1
                  teacher_id: 1
                  subject_id: 2
                  group_id: 3
                  period_id: 1

    /api/assignments/{id}:
      get:
        summary: CU13 - Obtener asignación por id (Admin)
        tags:
          - Carga Horaria
        security:
          - cookieAuth: []
        parameters:
          - in: path
            name: id
            schema:
              type: integer
            required: true
        responses:
          '200':
            description: Asignación
            content:
              application/json:
                example:
                  id: 1
                  teacher_id: 1
                  subject_id: 2
                  group_id: 3
                  period_id: 1

      patch:
        summary: CU13 - Actualizar asignación (Admin)
        tags:
          - Carga Horaria
        security:
          - cookieAuth: []
        parameters:
          - in: path
            name: id
            schema:
              type: integer
            required: true
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  subject_id:
                    type: integer
                  group_id:
                    type: integer
                  period_id:
                    type: integer
              example:
                subject_id: 2
                group_id: 3
        responses:
          '200':
            description: Asignación actualizada
            content:
              application/json:
                example:
                  id: 1
                  teacher_id: 1
                  subject_id: 2
                  group_id: 3
                  period_id: 1

      delete:
        summary: CU13 - Eliminar asignación (Admin)
        tags:
          - Carga Horaria
        security:
          - cookieAuth: []
        parameters:
          - in: path
            name: id
            schema:
              type: integer
            required: true
        responses:
          '200':
            description: Asignación eliminada
            content:
              application/json:
                example:
                  message: "Assignment deleted"
                  id: 1

    /api/schedules:
      get:
        summary: CU14 - Listar horarios (Admin)
        tags:
          - Horarios
        security:
          - cookieAuth: []
        parameters:
          - in: query
            name: group_id
            schema:
              type: integer
          - in: query
            name: teacher_id
            schema:
              type: integer
        responses:
          '200':
            description: Lista de horarios
            content:
              application/json:
                example:
                  - id: 1
                    group_id: 3
                    room_id: 5
                    teacher_id: 1
                    day_of_week: monday
                    start_time: "08:00"
                    end_time: "10:00"

      post:
        summary: CU14 - Crear horario (Admin)
        tags:
          - Horarios
        security:
          - cookieAuth: []
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  group_id:
                    type: integer
                  room_id:
                    type: integer
                  teacher_id:
                    type: integer
                  day_of_week:
                    type: string
                  start_time:
                    type: string
                    format: time
                  end_time:
                    type: string
                    format: time
                required:
                  - group_id
                  - day_of_week
                  - start_time
                  - end_time
              example:
                group_id: 3
                room_id: 5
                teacher_id: 1
                day_of_week: monday
                start_time: "08:00"
                end_time: "10:00"
        responses:
          '201':
            description: Horario creado
            content:
              application/json:
                example:
                  id: 1
                  group_id: 3
                  room_id: 5
                  teacher_id: 1
                  day_of_week: monday
                  start_time: "08:00"
                  end_time: "10:00"

      /api/schedules/generate:
        post:
          summary: CU15 - Generar horario automáticamente (Admin)
          tags:
            - Horarios
          security:
            - cookieAuth: []
          requestBody:
            required: false
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    period_id:
                      type: integer
                example:
                  period_id: 1
          responses:
            '200':
              description: Resultado de la generación
              content:
                application/json:
                  example:
                    created: 10
                    schedules: []

      /api/schedules/export:
        get:
          summary: Exportar horarios a Excel (Docente/Admin)
          tags:
            - Horarios
          security:
            - cookieAuth: []
          parameters:
            - in: query
              name: teacher_id
              schema:
                type: integer
            - in: query
              name: group_id
              schema:
                type: integer
          responses:
            '200':
              description: Archivo XLSX con horarios
              content:
                application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
                  schema:
                    type: string
                    format: binary

          /api/schedules/export.pdf:
            get:
              summary: Exportar horarios a PDF (Docente/Admin)
              tags:
                - Horarios
              security:
                - cookieAuth: []
              parameters:
                - in: query
                  name: teacher_id
                  schema:
                    type: integer
                - in: query
                  name: group_id
                  schema:
                    type: integer
              responses:
                '200':
                  description: Archivo PDF con horarios
                  content:
                    application/pdf:
                      schema:
                        type: string
                        format: binary
                '501':
                  description: PDF export no disponible (dependencia faltante)
                  content:
                    application/json:
                      example:
                        message: "PDF export not available. Please install barryvdh/laravel-dompdf"

      /api/schedules/weekly:
        get:
          summary: CU16 - Visualizar horario semanal (Docente / Admin)
          tags:
            - Horarios
          security:
            - cookieAuth: []
          parameters:
            - in: query
              name: teacher_id
              schema:
                type: integer
            - in: query
              name: group_id
              schema:
                type: integer
          responses:
            '200':
              description: Horario semanal agrupado por día
              content:
                application/json:
                  example:
                    monday:
                      - id: 1
                        group_id: 3
                        room_id: 5
                        teacher_id: 1
                        start_time: "08:00"
                        end_time: "10:00"

      /api/attendances:
        get:
          summary: CU17 - Listar asistencias (Docente/Admin)
          tags:
            - Asistencias
          security:
            - cookieAuth: []
          parameters:
            - in: query
              name: teacher_id
              schema:
                type: integer
            - in: query
              name: date
              schema:
                type: string
                format: date
          responses:
            '200':
              description: Lista de registros de asistencia
              content:
                application/json:
                  example:
                    - id: 1
                      teacher_id: 1
                      date: "2025-11-02"
                      time: "08:05"
                      status: present

        post:
          summary: CU17 - Registrar asistencia docente (Docente/Admin)
          tags:
            - Asistencias
          security:
            - cookieAuth: []
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    teacher_id:
                      type: integer
                    schedule_id:
                      type: integer
                    date:
                      type: string
                      format: date
                    time:
                      type: string
                      format: time
                    status:
                      type: string
                      enum: [present,absent,late]
                    notes:
                      type: string
                  required:
                    - teacher_id
                    - date
                    - status
                example:
                  teacher_id: 1
                  date: "2025-11-02"
                  time: "08:05"
                  status: present
          responses:
            '201':
              description: Registro creado
              content:
                application/json:
                  example:
                    id: 1
                    teacher_id: 1
                    date: "2025-11-02"
                    time: "08:05"
                    status: present

          /api/attendances/qr:
            post:
              summary: CU18 - Registrar asistencia mediante código QR (Docente/Admin)
              tags:
                - Asistencias
              security:
                - cookieAuth: []
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        schedule_id:
                          type: integer
                        qr_payload:
                          type: string
                      required:
                        - schedule_id
                    example:
                      schedule_id: 10
                      qr_payload: "SCHEDULE:10;TS:169"
              responses:
                '201':
                  description: Asistencia registrada
                  content:
                    application/json:
                      example:
                        id: 11
                        teacher_id: 3
                        schedule_id: 10
                        date: "2025-11-03"
                        time: "08:05"
                        status: present

          /api/schedules/{id}/cancel:
            post:
              summary: CU19 - Anular clase o cambiar a modalidad virtual (Docente/Admin)
              tags:
                - Horarios
              security:
                - cookieAuth: []
              parameters:
                - in: path
                  name: id
                  schema:
                    type: integer
                  required: true
                  description: ID del horario a anular
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      type: object
                      properties:
                        mode:
                          type: string
                          enum: [cancelled, virtual]
                        reason:
                          type: string
                      required:
                        - mode
                    example:
                      mode: cancelled
                      reason: "Docente enfermo"
              responses:
                '201':
                  description: Registro de anulación creado
                  content:
                    application/json:
                      example:
                        message: "Class cancelled"
                        cancellation:
                          id: 1
                          schedule_id: 10
                          mode: cancelled
                          reason: "Docente enfermo"

              /api/cancellations:
                get:
                  summary: Listar anulaciones de clases (Docente/Admin)
                  tags:
                    - Horarios
                  security:
                    - cookieAuth: []
                  parameters:
                    - in: query
                      name: teacher_id
                      schema:
                        type: integer
                    - in: query
                      name: schedule_id
                      schema:
                        type: integer
                  responses:
                    '200':
                      description: Lista de anulaciones
                      content:
                        application/json:
                          example:
                            - id: 1
                              schedule_id: 10
                              teacher_id: 3
                              mode: cancelled
                              reason: "Docente enfermo"

              /api/cancellations/{id}:
                get:
                  summary: Obtener anulación por id (Docente/Admin)
                  tags:
                    - Horarios
                  security:
                    - cookieAuth: []
                  parameters:
                    - in: path
                      name: id
                      schema:
                        type: integer
                      required: true
                  responses:
                    '200':
                      description: Registro de anulación
                      content:
                        application/json:
                          example:
                            id: 1
                            schedule_id: 10
                            teacher_id: 3
                            mode: cancelled
                            reason: "Docente enfermo"
                delete:
                  summary: Eliminar anulación (Admin)
                  tags:
                    - Horarios
                  security:
                    - cookieAuth: []
                  parameters:
                    - in: path
                      name: id
                      schema:
                        type: integer
                      required: true
                  responses:
                    '200':
                      description: Anulación eliminada
                      content:
                        application/json:
                          example:
                            message: "Cancellation deleted"
                            id: 1

      /api/attendances/{id}:
        get:
          summary: CU17 - Obtener registro de asistencia (Docente/Admin)
          tags:
            - Asistencias
          security:
            - cookieAuth: []
          parameters:
            - in: path
              name: id
              schema:
                type: integer
              required: true
          responses:
            '200':
              description: Registro
              content:
                application/json:
                  example:
                    id: 1
                    teacher_id: 1
                    date: "2025-11-02"
                    time: "08:05"
                    status: present

        patch:
          summary: CU17 - Actualizar registro de asistencia (Docente/Admin)
          tags:
            - Asistencias
          security:
            - cookieAuth: []
          parameters:
            - in: path
              name: id
              schema:
                type: integer
              required: true
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    status:
                      type: string
                      enum: [present,absent,late]
                    notes:
                      type: string
          responses:
            '200':
              description: Registro actualizado
              content:
                application/json:
                  example:
                    id: 1
                    teacher_id: 1
                    date: "2025-11-02"
                    time: "08:05"
                    status: present

        delete:
          summary: CU17 - Eliminar registro de asistencia (Admin)
          tags:
            - Asistencias
          security:
            - cookieAuth: []
          parameters:
            - in: path
              name: id
              schema:
                type: integer
              required: true
          responses:
            '200':
              description: Registro eliminado
              content:
                application/json:
                  example:
                    message: "Attendance deleted"
                    id: 1

    /api/schedules/{id}:
      get:
        summary: CU14 - Obtener horario por id (Admin)
        tags:
          - Horarios
        security:
          - cookieAuth: []
        parameters:
          - in: path
            name: id
            schema:
              type: integer
            required: true
        responses:
          '200':
            description: Horario
            content:
              application/json:
                example:
                  id: 1
                  group_id: 3
                  room_id: 5
                  teacher_id: 1
                  day_of_week: monday
                  start_time: "08:00"
                  end_time: "10:00"

      patch:
        summary: CU14 - Actualizar horario (Admin)
        tags:
          - Horarios
        security:
          - cookieAuth: []
        parameters:
          - in: path
            name: id
            schema:
              type: integer
            required: true
        requestBody:
          required: true
          content:
            application/json:
              schema:
                type: object
                properties:
                  group_id:
                    type: integer
                  room_id:
                    type: integer
                  teacher_id:
                    type: integer
                  day_of_week:
                    type: string
                  start_time:
                    type: string
                    format: time
                  end_time:
                    type: string
                    format: time
        responses:
          '200':
            description: Horario actualizado
            content:
              application/json:
                example:
                  id: 1
                  group_id: 3
                  room_id: 5
                  teacher_id: 1
                  day_of_week: monday
                  start_time: "08:00"
                  end_time: "10:00"

      delete:
        summary: CU14 - Eliminar horario (Admin)
        tags:
          - Horarios
        security:
          - cookieAuth: []
        parameters:
          - in: path
            name: id
            schema:
              type: integer
            required: true
        responses:
          '200':
            description: Horario eliminado
            content:
              application/json:
                example:
                  message: "Schedule deleted"
                  id: 1


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    cookieAuth:
      type: apiKey
      in: cookie
      name: laravel_session
